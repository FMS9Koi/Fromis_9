machine:
  pre:
    # Fix git
    - rm ~/.gitconfig

    # Install rust
    - curl -sS https://static.rust-lang.org/rustup.sh | sudo sh -s -- --channel=nightly --yes --save

dependencies:
  pre:    
    # Get other deps
    - sudo apt-get update
    - sudo apt-get install -y curl libav-tools libavcodec-extra build-essential openssl libopus-dev libopus0 
    
    # Link ffmpeg
    - sudo ln -s /usr/bin/avconv /usr/bin/ffmpeg
    
    # Donload youtube-dl
    - sudo curl -L https://yt-dl.org/downloads/latest/youtube-dl -o /usr/local/bin/youtube-dl
    - sudo chmod a+rx /usr/local/bin/youtube-dl

    # Compile libsodium
    - wget https://download.libsodium.org/libsodium/releases/libsodium-1.0.11.tar.gz
    - tar xvfz libsodium-1.0.11.tar.gz
    - cd libsodium-1.0.11 && ./configure && make && sudo make install

test:
  override:
    - cargo build -v
    - cargo test -v
